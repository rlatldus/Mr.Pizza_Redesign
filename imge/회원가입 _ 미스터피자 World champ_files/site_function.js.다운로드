//------------------------------
// 온라인 주문
//------------------------------
function go_OnlineOrder() {
	//location.href="/order/deliveryOrder";
	setOrderTypeSelection(1, 'move');
}

//------------------------------
//메뉴 리스트 이동
//------------------------------
function go_order_site(mCode) {
	
	if(mCode == '10') {		//보파
		location.href="/menu/bonuspouch";
	} else if(mCode == '11') {		//홈런박스
		location.href="/menu/homerunbox";
	} else if(mCode == '12') {		//투런홈런박스
		location.href="/menu/tworunbox";
	} else {						//프리미엄피자
		location.href="/menu/premium";
	}
}

//------------------------------
// 회원 로그인 정보 비교(팝업)
//------------------------------
function onPopLogin() {
	
	var frm = null;
	frm = document.getElementById("popLoginForm");
	
	if(frm.user_id.value == "" || frm.user_id.value == "undefined" || frm.user_id.value == "아이디")
	{
		$(".pop_login").addClass("wrong_login");
		$("#popLoginResult").css("visibility", "visible");
		return false;
	}
	
	if(frm.user_pwd.value == "" || frm.user_pwd.value == "undefined" || frm.user_pwd.value == "비밀번호")
	{
		$(".pop_login").addClass("wrong_login");
		$("#popLoginResult").css("visibility", "visible");
		return false;
	}
	
	var param = [];
	param.push("user_id="+frm.user_id.value);
	param.push("user_pwd=" + frm.user_pwd.value);
	
	param = paramEncriptPost(param);
	
	$.ajax({
		type: "POST",
		//url: "/login_join/getUserInfo",
		url: "https://"+location.hostname+"/login_join/getUserInfo",
		data: param,
		contentType: "application/x-www-form-urlencoded; charset=utf-8",
		//dataType: "json",
		dataType: "jsonp",
		jsonp: "callback",
		success: function(data) 
		{
			/*
			 *  data 결과 = data.size(결과수)
			 *  0 < data.size 	아이디 및 패스워드가 일치하지 않음
			 *  1 = data.size 	아이디 및 패스워드 일치
			 *  
			 */
			if(data.size < 1)
			{	
				$(".pop_login").addClass("wrong_login");
				$("#popLoginResult").css("visibility", "visible");
			} 
			else if (data.size == 1)
			{	
				onPopLoginProcess(data.id);
			}
		},
		error: function(request, error) 
		{
			window.alert("요청 실패");
			alert(request.statusText);
			alert(request.responseText);
		}
	}); // ajax
}

//------------------------------
//회원 로그인 처리(팝업)
//------------------------------
function onPopLoginProcess(cust_id) {
	
	var frm = document.getElementById("popLoginForm");
	
	if(frm.user_id.value == cust_id) {
		
		if(frm.idcheck.checked == true)
			setCookie("userID", cust_id, 365);
		else
			delete_cookie("userID");
	}
	
	var param = [];
	param.push("user_id="+frm.user_id.value);
	param.push("user_pwd=" + frm.user_pwd.value);
	
	param = paramEncriptPost(param);
	
	$.ajax({
		type: "POST",
		//url: "/login_join/popLoginProc",
		url: "https://"+location.hostname+"/login_join/popLoginProc",
		data: param,
		contentType: "application/x-www-form-urlencoded; charset=utf-8",
		//dataType: "text",
		dataType: "jsonp",
		jsonp: "callback",
		success: function(data) 
		{
			var result = data.result;
			
			switch(result)
			{
				case "SUCCESS":
					//PopLogin Close
					$('.pop_close').trigger('click');
					
					//로그인 성공 시 URL 및 명칭 변경
					$('#loginURL').attr('href','/login_join/logout').text('로그아웃');
					$('#joinURL').attr('href','/mypage/myInfo_step1').text('회원정보수정');
					$('#orderListURL').css("display","inline");
					$('#onlineURL').html('<a href="#" onClick="javascript:go_OnlineOrder();">온라인 주문하기</a>');
					$('#quickLoginURL').attr('href','/login_join/logout').text('로그아웃');
					
					// "/login_join/login 페이지일 경우 홈으로 이동
					/*var url = window.location.href;
					var len = url.length - 17;
					
					if(url.substr(len) == "/login_join/login")
						//location.href = "/index";
						go_OnlineOrder();*/
					
					go_OnlineOrder();
					
					break;
				default:
					$("#popLoginResult").css("visibility", "visible");
					break;
			}
			
		},
		error: function(request, error) 
		{
			window.alert("요청 실패");
			alert(request.statusText);
			alert(request.responseText);
		}
	}); // ajax
}

//------------------------------
//회원 쿠키 체크(팝업)
//------------------------------
function getLogin() {
	// Cookie Check
	if(getCookie("userID") != null){
		$("#popUser_id").val(getCookie("userID"));
		$("#popIdcheck").attr("checked", true);
	}
}

//------------------------------
//비회원 로그인
//------------------------------
function onGuestLogin() {
	
	if(!($('#guest_agree_chk').attr("checked"))) {
		alert('이용약관을 읽으신 후,\n동의 항목 부분을 체크해주세요.');
		return;
	} else {
		$.ajax({
			type: "POST",
			url: "/login_join/popGuestLoginProc",
			contentType: "application/x-www-form-urlencoded; charset=utf-8",
			dataType: "text",
			success: function(data) 
			{
				//alert(data);
				
				if(data == 'SUCCESS') {
					location.href="/order/deliveryOrder";
				} else {
					//ERROR_ORDER_NONE
					alert('잘못된 결과입니다.\n다시 확인해주십시오.');
				}
			},
			error: function(request, error) 
			{
				window.alert("요청 실패");
				alert(request.statusText);
				alert(request.responseText);
			}
		}); // ajax
	}
}

//----------------------------------------------------------------
//주문 유형 변경(order_type : 주문유형, act : 이동(move), 로드(load))
//----------------------------------------------------------------
function setOrderTypeSelection(order_type, act) {
		
	var goUrl = '';
	
	if(order_type == 1)
		goUrl = "https://"+location.hostname+"/order/deliveryOrder";
	else if(order_type == 2)
		goUrl = "https://"+location.hostname+"/order/visitOrder";
	else if(order_type == 3)
		goUrl = "https://"+location.hostname+"/order/presentOrder";
	
	var params = {
		order_type : order_type
	};
	
	$.ajax({
		type: "POST",
		url: "/order/updOrderType",
		data: params,
		contentType: "application/x-www-form-urlencoded; charset=utf-8",
		dataType: "text",
		success: function(data) 
		{
			var result = data;
			
			switch(result)
			{
				case "SUCCESS":
					if(act == 'move') {
						location.href = goUrl;
					} else if(act == 'load') {
						alert('주문유형이 변경되었습니다');
					}
					break;
				default:
					alert('주문유형 업데이트 실패');
					break;
			}
			
			return;
		},
		error: function(request, error) 
		{
			window.alert("요청 실패");
			alert(request.statusText);
			alert(request.responseText);
		}
	}); // ajax
}

//----------------------------------------------------------------
//레이어 팝업 보여주기
//----------------------------------------------------------------
function viewLayerPopup(layerPopup, top, left, mask)
{
	if(!top) top = 30;
	if(!left) left = 193;
	if(!mask) mask = 0.4;

	// Get the screen height and width
	var maskHeight = $(document).height();
	var maskWidth = $(window).width();

	// Set heigth and width to mask to fill up the whole screen
	$('#mask').css({'width':maskWidth,'height':maskHeight});

	// transition effect		
	$('#mask').fadeTo("slow", mask);

	// location
	var topPx = parseInt(document.documentElement.scrollTop) + parseInt(top) + "px";
	var leftPx = parseInt(document.body.clientWidth/2) - left + "px";

	//document.getElementById("msg").innerHTML = val;
	$("#"+layerPopup).css("display","block");
	$("#"+layerPopup).css("top",topPx);
	$("#"+layerPopup).css("left",leftPx);
}

//----------------------------------------------------------------
//layer popup hide
//----------------------------------------------------------------
function setLayerPopHide(target, mask) 
{
	if(mask == 'hidden')
	{
		$('#mask').hide();
	}
	
	$("#"+target).css("display","none");
	if($('.bgLayer').size()>0){
		$('.bgLayer').remove();
	}
	

}