//----------------------------------------------------
// 변수 선언 
//----------------------------------------------------
var tabCon = null;
var popCon = null;
var kainess_url = "http://59.10.203.212:8080/API/";

//구주소 검색 API URL
var kainess_dong_search_url = kainess_url + "getAddrSearch_Dong_Name2_db.do";
var kainess_bunji_search_url = kainess_url + "getAddrJibun3_db.do";
var kainess_build_search_url = kainess_url + "poiSearch2.do";

// 도로명 주소 검색 URL
var kainess_road_search_url  = kainess_url + "getRoadname2_db.do";
var kainess_jibun_search_url = kainess_url + "getRoadaddrSearchList2_db.do";
var kainess_bc_search_url    = kainess_url + "getRoadnameSearch_build2_db.do";

// 주소 변환 URL
var kainess_convert_roadJibun_url = kainess_url + "addr_ch_tr.do";

//----------------------------------------------------
//결과값 초기화 - 읍/면/동, 도로명
//----------------------------------------------------
function clearFirstSearchResult(){
	
	$(".searchBunji").val("");
	$(".searchJibun").val("");
	$(".full_address").val("");
	
	$("#search_result_code").val("");
	$("#search_result_sido").val("");
	$("#search_result_gugun").val("");
	$("#search_result_dong").val("");
	$("#search_result_ri").val("");
	$("#search_result_fullname").val("");
}

//----------------------------------------------------
//결과값 초기화 - 번지, 건물명, 건물번호
//----------------------------------------------------
function clearSecondSearchResult(){
	
	$(tabCon+" .addressList").empty();
	$(".addressDetail").val("");
	$(".detailAddress").val("");
	
	$("#search_result_bunji").val("");
	$("#search_result_building").val("");
	$("#search_result_point_x").val("");
	$("#search_result_point_y").val("");
	$("#search_result_add_type").val("");
	$("#search_result_flag").val("");
	$("#search_result_convertRoad").val("");
	$("#search_result_zipcode").val("");
	$("#search_result_addr").val("");
	$("#search_result_branch_idx").val("");
	$("#search_result_branch_title").val("");
	$("#search_result_branch_zoneidx").val("");
	$("#search_result_branch_zonetitle").val("");
	$("#search_result_branch_zonetime").val("");
}


//----------------------------------------------------
// 지번주소 결과값 선택 - 읍/면/동
//----------------------------------------------------
function selectDong(code, sido, gugun, dong, ri, fullname){
	
	$(".searchDong").val("");
	$(".addressList").empty();
	
	$(".searchDong").val(dong);
	$(".full_address").val(fullname);
	
	$("#search_result_code").val(code);
	$("#search_result_sido").val(sido);
	$("#search_result_gugun").val(gugun);
	$("#search_result_dong").val(dong);
	$("#search_result_ri").val(ri);
	$("#search_result_fullname").val(fullname);
	
	$(".searchBunji").focus();
}

//----------------------------------------------------
// 지번주소 결과값 선택 - 번지
//----------------------------------------------------
function selectBunji(bunji, building, point_x, point_y, add_type, flag, zipcode){
	
	$(".searchBunji").val("");
	$(".addressList").empty();
	
	if(building == ""){
		$(".searchBunji").val(bunji);
		$(".full_address").val($("#search_result_fullname").val() + " " + bunji);
	}
	else{
		$(".searchBunji").val(building);
		$(".full_address").val($("#search_result_fullname").val() + " " + building);
	}
	
	$("#search_result_bunji").val(bunji);
	$("#search_result_building").val(building);
	$("#search_result_point_x").val(point_x);
	$("#search_result_point_y").val(point_y);
	$("#search_result_add_type").val(add_type);
	$("#search_result_flag").val(flag);
	$("#search_result_zipcode").val(zipcode);
	
	var fullname = $("#search_result_fullname").val();
	
	if(building == "")
		$("#search_result_addr").val(fullname+" "+bunji);
	else
		$("#search_result_addr").val(fullname+" "+building);

	var mode = 0;
	if(popCon == "#zipcode")
		mode = 1;  
	
	searchBranch(point_x, point_y, mode);
		
	$(".addressDetail").focus();
}

//----------------------------------------------------
// 매장팝업 - 지번주소 결과값 선택 - 좌표로 매장찾기
//----------------------------------------------------
function searchBranch(x, y, mode){
	
	$(tabCon+" .addressList").empty();
	
	if(!mode) // 매장팝업일때만 표시
	$(tabCon+" .addressList").append("<li>주변 매장 목록을 검색 중 입니다.</li>");
	
	var params = {
		x : x,
		y : y,
	};
	
	$.ajax({
		type: "POST",
		url : "/common/getStoreIdx.json",
		data: params,
		dataType: "json",
        contentType:'application/x-www-form-urlencoded; charset=UTF-8',
		success:function(data){
					console.log(data);		
			//지번주소 검색리스트 초기화
			$(tabCon+" .addressList").empty();
				
			if(data.length == 0){
				//$(tabCon+" .addressList").append("<li>주변 매장이 존재하지 않습니다.</li>");
				$(tabCon+" .addressList").append("");
				
				$("#search_result_branch_idx").val("");
				$("#search_result_branch_title").val("");
				$("#search_result_branch_zoneidx").val("");
				$("#search_result_branch_zonetitle").val("");
				$("#search_result_branch_zonetime").val("");
				
				$("#storename").empty();
				$("#storename").append("배달 가능한 매장이 없습니다.");
			}
				
			else{
				var idx	  = data[0].idx;
				var title = data[0].title; 
           		var zoneidx = data[0].zoneidx;
           		var zonetitle = data[0].zonetitle;
           		var zonetime = data[0].time;
				
				// 검색 주소에 대한 주변 매장정보 표시
				$.ajax({
					type: "POST",
					url: "/common/getStoreInfo.json",
					data: {branch_id : idx},
					contentType: "application/x-www-form-urlencoded; charset=utf-8",
					dataType: "json",
					success: function(data) 
					{
						$("#search_result_branch_idx").val("");
						$("#search_result_branch_title").val("");
						$("#search_result_branch_zoneidx").val("");
						$("#search_result_branch_zonetitle").val("");
						$("#search_result_branch_zonetime").val("");
						
						if(data.length > 0){
							$("#search_result_branch_idx").val(idx);
							$("#search_result_branch_title").val(title);
							$("#search_result_branch_zoneidx").val(zoneidx);
							$("#search_result_branch_zonetitle").val(zonetitle);
							$("#search_result_branch_zonetime").val(zonetime);
							
							$("#storename").empty();
							$("#storename").append(title);
						}
						else{
							$("#storename").empty();
							$("#storename").append("배달 가능한 매장이 없습니다.");
						}
					},
					error: function()
					{
						alert("주변 매장 정보 요청 실패");
					}
				});
			}
		},
		error:function(){
			alert("매장검색 요청 실패");
		}
	});	
}

//----------------------------------------------------
// 매장검색 결과값 선택 
//----------------------------------------------------
function selectBranch(idx, title, zoneidx, zonetitle, zonetime, i){
	
	$("#search_result_branch_idx").val(idx);
	$("#search_result_branch_title").val(title);
	$("#search_result_branch_zoneidx").val(zoneidx);
	$("#search_result_branch_zonetitle").val(zonetitle);
	$("#search_result_branch_zonetime").val(zonetime);
	
	$(".addressDetail").val(title);
	$(tabCon+" .addressList li").removeClass("on");
	$(tabCon+" .addressList li").eq(i).addClass("on");
	
	var params = {
			branch_id : idx
			};
	$.ajaxSetup({
			async: false
		});
	
	$.ajax({
		type: "POST",
		url : "/common/getStoreInfo.json",
		data: params,
		dataType: "json",
        contentType:'application/x-www-form-urlencoded; charset=UTF-8',
		success:function(data){
											
			if(data.length == 0)
				alert("매장 데이터 존재하지 않음.");
			else{  
				var branch_id = data[0].branch_id;
				var branch_nm = data[0].branch_nm; 
	        	var branch_cn = data[0].branch_cn;
	          	var branch_own = data[0].branch_own;
	          	var branch_mgr = data[0].branch_mgr;
	           	var branch_type_cd = data[0].branch_type_cd;
	           	var branch_store_cd = data[0].branch_store_cd;
	           	var branch_state_cd = data[0].branch_state_cd;
	           	var branch_status_memo = data[0].branch_status_memo;
	           	var hofficd_flag = data[0].hofficd_flag;
	           	var cs_flag = data[0].cs_flag;
	           	var cs_date = data[0].cs_date;
	           	var branch_si = data[0].si;
	           	var branch_gu = data[0].gu;
	           	var branch_dong = data[0].dong;
	           	var branch_bunji = data[0].bunji;
	           	var branch_building = data[0].building;
	           	var branch_full_address = data[0].full_address;
	           	var addr_flag = data[0].addr_flag;
	           	var branch_tel = data[0].branch_tel;
	           	var branch_tel1 = data[0].branch_tel1;
	           	var branch_tel2 = data[0].branch_tel2;
	           	var receive_tel = data[0].receive_tel;
	           	var phone_own = data[0].phone_own;
	           	var phone_mgr = data[0].phone_mgr;
	           	var phone_emc = data[0].phone_emc;
	           	var fax = data[0].fax;
	           	var phone_memo = data[0].phone_memo;
	           	var dtp_no = data[0].dtp_no;
	           	var dtp_flag = data[0].dtp_flag;
	           	var seat_count = data[0].seat_count;
	           	var car_flag = data[0].car_flag;
	           	var car_memo = data[0].car_memo;
	           	var day_stime = data[0].day_stime;
	           	var day_etime = data[0].day_etime;
	           	var week_stime = data[0].week_stime;
	           	var week_etime = data[0].week_etime;
	           	var sal_etime = data[0].sal_etime;
	           	var cdate = data[0].cdate;
	           	var udate = data[0].udate;
	           	var utime = data[0].utime;
	           	var sv_nm = data[0].sv_nm;
	           	var reset_flag = data[0].reset_flag;
	           	var edate = data[0].edate;
	           	var delivery_time = data[0].delivery_time;
	           	var holiday = data[0].holiday;
	           		
	           	$("#search_result_branch_id").val(branch_id);
	           	$("#search_result_branch_nm").val(branch_nm); 
	           	$("#search_result_branch_cn").val(branch_cn);
	           	$("#search_result_branch_own").val(branch_own);
	           	$("#search_result_branch_mgr").val(branch_mgr);
	           	$("#search_result_branch_type_cd").val(branch_type_cd);
	           	$("#search_result_branch_store_cd").val(branch_store_cd);
	           	$("#search_result_branch_state_cd").val(branch_state_cd);
	           	$("#search_result_branch_status_memo").val(branch_status_memo);
	           	$("#search_result_hofficd_flag").val(hofficd_flag);
	           	$("#search_result_cs_flag").val(cs_flag);
	           	$("#search_result_cs_date").val(cs_date);
	           	$("#search_result_branch_si").val(branch_si);
	           	$("#search_result_branch_gu").val(branch_gu);
	           	$("#search_result_branch_dong").val(branch_dong);
	           	$("#search_result_branch_bunji").val(branch_bunji);
	           	$("#search_result_branch_building").val(branch_building);
	           	$("#search_result_branch_full_address").val(branch_full_address);
	           	$("#search_result_addr_flag").val(addr_flag);
	           	$("#search_result_branch_tel").val(branch_tel);
	           	$("#search_result_branch_tel1").val(branch_tel1);
	           	$("#search_result_branch_tel2").val(branch_tel2);
	           	$("#search_result_receive_tel").val(receive_tel);
	           	$("#search_result_phone_own").val(phone_own);
	           	$("#search_result_phone_mgr").val(phone_mgr);
	           	$("#search_result_phone_emc").val(phone_emc);
	           	$("#search_result_fax").val(fax);
	           	$("#search_result_phone_memo").val(phone_memo);
	           	$("#search_result_dtp_no").val(dtp_no);
	           	$("#search_result_dtp_flag").val(dtp_flag);
	           	$("#search_result_seat_count").val(seat_count);
	           	$("#search_result_car_flag").val(car_flag);
	           	$("#search_result_car_memo").val(car_memo);
	           	$("#search_result_day_stime").val(day_stime);
	           	$("#search_result_day_etime").val(day_etime);
	           	$("#search_result_week_stime").val(week_stime);
	           	$("#search_result_week_etime").val(week_etime);
	           	$("#search_result_sal_etime").val(sal_etime);
	           	$("#search_result_cdate").val(cdate);
	           	$("#search_result_udate").val(udate);
	           	$("#search_result_utime").val(utime);
	           	$("#search_result_sv_nm").val(sv_nm);
	           	$("#search_result_reset_flag").val(reset_flag);
	           	$("#search_result_edate").val(edate);
	           	$("#search_result_delivery_time").val(delivery_time);
	           	$("#search_result_holiday").val(holiday);
						
			}
		},
		error:function(){
			alert("데이터 검색 요청 실패");
		}
	});	
	
	
}

//----------------------------------------------------
// 도로명주소 결과값 선택 - 도로명
//----------------------------------------------------
function selectRoad(code, sido, gugun, dong, ri, fullname){
	
	$(".searchRoad").val("");
	$(".addressList").empty();
	
	$(".searchRoad").val(ri);
	$(".full_address").val(fullname);
	
	$("#search_result_code").val(code);
	$("#search_result_sido").val(sido);
	$("#search_result_gugun").val(gugun);
	$("#search_result_dong").val(ri);
	$("#search_result_ri").val(dong);
	$("#search_result_fullname").val(fullname);
	
	$(".searchBunji").focus();
}

//----------------------------------------------------
//도로명주소 결과값 선택 - 지번, 건물명
//----------------------------------------------------
function selectJibun(jibun, building, point_x, point_y, add_type, flag, zipcode){
		
	$(".searchJibun").val("");
	$(".addressList").empty();
	
	$(".searchJibun").val(jibun);
	$(".full_address").val($("#search_result_fullname").val() + " " + jibun);
	
	$("#search_result_bunji").val(jibun);
	$("#search_result_building").val(building);
	$("#search_result_point_x").val(point_x);
	$("#search_result_point_y").val(point_y);
	$("#search_result_add_type").val(add_type);
	$("#search_result_flag").val(flag);
	$("#search_result_zipcode").val(zipcode);
	
	var fullname = $("#search_result_fullname").val() + " " + jibun;
	$("#search_result_addr").val(fullname);
	
	//도로명주소 -> 지번주소로 변환
	convertRoadJibun(fullname, point_x, point_y);
	
}

//----------------------------------------------------
//도로명주소 -> 지번주소로 변환
//----------------------------------------------------
function convertRoadJibun(fullname, point_x, point_y){
	var params ={ 
		 url : kainess_convert_roadJibun_url,
		 url_code : "06",
		 addr : fullname
	}; 
	
	$.ajax({
		type: "POST",
		url : "/common/getAddress.json",
		data: params,
		dataType: "json",
		contentType:'application/x-www-form-urlencoded; charset=UTF-8',
		success:function(data){

			if(data.length == 0)
				$("#search_result_convertRoad").val("");
			else{
				
				var address = data[0].address; // 변환된 주소
				var sido = data[0].sido;
				var gugun = data[0].gugun;
				
				address = address.replace(sido+" ","");
				address = address.replace(gugun+" ","");
				
				$("#search_result_convertRoad").val(address);
				
				var mode = 0;
				if(popCon == "#zipcode")
					mode = 1; 
				
				searchBranch(point_x, point_y, mode);
			}
		},
		error:function(){
			alert("주소검색 요청 실패");
		}
	});	

}
//----------------------------------------------------
//매장명검색 결과값 선택 
//----------------------------------------------------
/*function selectStore(branch_id, branch_nm){
		
	$(".searchStore").val("");
	$("#tabCon5 .addressList").empty();
	$(".searchStore").val(branch_nm);
	
	$("#search_result_branch_id").val(branch_id);
	$("#search_result_branch_nm").val(branch_nm);
	
	selectBranch(idx, title, dz_time, i);
}*/

$(function(){

	//----------------------------------------------------
	// 주소찾기 선택 시 입력값 초기화 & 탭 값 입력
	//----------------------------------------------------
	$(".zip_open").click(function(){
		
		// 입력창 초기화
		$(".inp_enter").val("");
		$(".addressList").empty();
		$(".addressDetail").val("");
		
		popCon = $(this).attr('href');
		tabCon = $(popCon + " .zipTab li:eq(0) a").attr('href');
		$(popCon + " .zipTab li:eq(0) a").trigger("click");
		
		daumPostcode('orderDaumZipcode','orderAddress1');
		
		$(".inp_enter").blur();
		$(".addressDetail").blur();
		
	});
	
	//----------------------------------------------------
	// 탭 선택 시 기존 데이터 초기화
	//----------------------------------------------------
	$(".zipTab li a").click(function(){
		
		// 입력창 초기화
		$("#zipcode input").val("");
		$(".addressList").empty();
		
		// 탭 선택값 저장
		tabCon = $(this).attr('href');
		
		$(".inp_enter").blur();
		$(".addressDetail").blur();
		
		if(tabCon == "#tabCon1")
			$("#search_result_gubun").val(1);
		else
			$("#search_result_gubun").val(2);

	});
	
	//----------------------------------------------------
	// Input Enter Key Event Check
	//----------------------------------------------------
	$(".inp_enter").keyup(function(e){
		var code=(e.keyCode?e.keyCode:e.which);
		if(code == 13)
			$(this).parent().next().trigger('click');
		
	});
	
	//----------------------------------------------------
	// 지번 주소검색 - 동/읍/면 검색
	//----------------------------------------------------
	$(".searchDongBtn").click(function(e){
		
		if($(tabCon+" .searchDong").val() == "")
			alert("읍/면/동을 입력해주세요.");
		else{
			//지번주소 검색리스트 초기화
			clearFirstSearchResult();
			clearSecondSearchResult();
			
				
			//로딩 표시
			var addressList = "<li><a href=\"#\">주소정보를 읽어오고 있습니다.</a></li>";
			$(tabCon+" .addressList").append(addressList);
				
			var params = 
					{url:kainess_dong_search_url,
					 url_code:"01",
					 name:$(tabCon+" .searchDong").val()
					 }; 
				
			// 버튼 이중클릭 방지
			$(this).attr("disabled", true);
			
			$.ajax({
				type: "POST",
				url : "/common/getAddress.json",
				data: params,
				dataType: "json",
		        contentType:'application/x-www-form-urlencoded; charset=UTF-8',
				success:function(data){
									
					//지번주소 검색리스트 초기화
					$(tabCon+" .addressList").empty();
						
					if(data.length == 0)
						$(tabCon+" .addressList").append("<li>주소가 존재하지 않습니다.</li>");
					else{
						for(var i=0; i<data.length; i++ ) {
				                 	
		            		var code   	 = data[i].code;
							var sido   	 = data[i].sido;
							var gugun    = data[i].gugun;
							var gubun    = data[i].gubun;
							var dong   	 = data[i].dong;
							var ri		 = data[i].ri;
							var fullname = data[i].fullname;
							var name	 = data[i].name;
							var rname	 = data[i].rname;
							
							
							if(ri == "" && gubun == "B")
								//ri = rname;
								ri = "";
							else if(ri == "" && gubun == "H"){
								ri = "("+dong+")";
								dong = name;
							}
							else
								ri = name;
							
							var addressList	 = "<li><a href=\"javascript:selectDong('"+code+"','"+sido+"','"+gugun+"','"+dong+"','"+ri+"','"+fullname+"');\">";
								addressList	+= fullname+"</a></li>";
							
							$(tabCon+" .addressList").append(addressList);
						}
					}
				},
				error:function(){
					alert("주소검색 요청 실패");
				}
			});	
				
			// 버튼 이중클릭 해제
			$(this).attr("disabled", false);
		}
	});	
	
	//----------------------------------------------------
	// 지번 주소검색 - 번지 검색
	//----------------------------------------------------
	$(".searchBunjiBtn").click(function(e){
			
		if($(tabCon+" .searchBunji").val() == "")
			alert("번지 또는 건물명을 입력해주세요.");
		else if($(tabCon+" .searchDong").val() == "" || $("#search_result_code").val()==""){
			alert("읍/면/동을 먼저 검색해주세요.");
			$(tabCon+" .searchDong").val("");
			$(tabCon+" .searchDong").focus();
		}
		else{
			//지번주소 검색리스트 초기화
			clearSecondSearchResult();
				
			//로딩 표시
			var addressList = "<li><a href=\"#\">주소정보를 읽어오고 있습니다.</a></li>";
			$(tabCon+" .addressList").append(addressList);
				
			var params = 
					{url : kainess_bunji_search_url,
					 url_code : "02",
					 code : $('#search_result_code').val(),
					 bunji : $(tabCon+" .searchBunji").val()
					 }; 
				
			// 버튼 이중클릭 방지
			$(this).attr("disabled", true);
			
			$.ajax({
				type: "POST",
				url : "/common/getAddress.json",
				data: params,
				dataType: "json",
		        contentType:'application/x-www-form-urlencoded; charset=UTF-8',
				success:function(data){
									
					//지번주소 검색리스트 초기화
					$(tabCon+" .addressList").empty();
						
					if(data.length == 0)
						$(tabCon+" .addressList").append("<li>주소가 존재하지 않습니다.</li>");
					else{
						for(var i=0; i<data.length; i++ ) {
				                 	
							var strText = "";
		            		if(data[i].san == "1" || data[i].san == "산") {
		            			strText = "산";
		            		}
		            			strText = strText + data[i].bunji;
		            			
	            			if(data[i].ho != "" && data[i].ho != "0") {
	            				strText = strText + "-" + data[i].ho;
	            			}
	            			
	            			var bcode	 = data[i].bcode;
	            			var bunji 	 = strText;
	            			var building = "";
	            			var point_x  = data[i].cx;
	            	        var point_y  = data[i].cy;
	            	        var add_type = "J";
	            	        var flag	 = "01";
							var zipcode	 = "123-456";
	    					
							if(data.length == 1 && bcode == "not found")
								$(tabCon+" .addressList").append("<li>주소가 존재하지 않습니다.</li>");
							
							else{
								var addressList	= "<li><a href=\"javascript:selectBunji('"+bunji+"','"+building+"','"+point_x+"','"+point_y+"','"+add_type+"','"+flag+"','"+zipcode+"');\">";
								addressList	+= bunji +"</a></li>";
							
								$(tabCon+" .addressList").append(addressList);
							}
						}
					}
				},
				error:function(){
					alert("주소검색 요청 실패");
				}
			});	
			
			// 버튼 이중클릭 해제
			$(this).attr("disabled", false);
		}
	});	
	
	//----------------------------------------------------
	// 지번 주소검색 - 건물명 검색
	//----------------------------------------------------
	$(".searchBuildingBtn").click(function(e){
	
		if($(tabCon+" .searchBunji").val() == "")
			alert("번지 또는 건물명을 입력해주세요.");
		else if($(tabCon+" .searchDong").val() == "" || $("#search_result_code").val()==""){
			alert("읍/면/동을 먼저 검색해주세요.");
			$(tabCon+" .searchDong").val("");
			$(tabCon+" .searchDong").focus();
		}
		else{
			//지번주소 검색리스트 초기화
			clearSecondSearchResult();
					
			//로딩 표시
			var addressList = "<li><a href=\"#\">주소정보를 읽어오고 있습니다.</a></li>";
			$(tabCon+" .addressList").append(addressList);
				
			var params = {
					url : kainess_build_search_url,	
					url_code : "03",
			  		dongcode:$("#search_result_code").val(),
			  		sido:$("#search_result_sido").val(),
			  		sigungu:$("#search_result_gugun").val(),
			  		dong:$("#search_result_dong").val(),
			  		name:encodeURI($(tabCon+" .searchBunji").val()),
			  		listCount:9999,
			  		pageNum:0
			  	};	
		
			// 버튼 이중클릭 방지
			$(this).attr("disabled", true);
			
			$.ajax({
				type: "POST",
				url : "/common/getAddress.json",
				data: params,
				dataType: "json",
		        contentType:'application/x-www-form-urlencoded; charset=UTF-8',
				success:function(data){
									
					//지번주소 검색리스트 초기화
					$(".addressList").empty();
						
					if(data.length == 0)
						$(".addressList").append("<li>주소가 존재하지 않습니다.</li>");
					else{
						for(var i=0; i<data.length; i++ ) {
				            
							
							var bunji = "";
							
							if(data[i].addr_bun == "" || data[i].addr_bun == null)
								bunji = "";
							
							else if(data[i].addr_bun != "" && data[i].addr_bun != null){
								if(data[i].addr_ho == 0 ||data[i].addr_ho == "" || data[i].addr_ho == null)
									bunji = data[i].addr_bun;
								else
									bunji = data[i].addr_bun + "-" + data[i].addr_ho;
							}
							else 
								bunji = "";
							
		        			var building = data[i].place_name;
		        	        var point_x  = data[i].point_x;
		        	        var point_y  = data[i].point_y;
		        	        var add_type = "B";
		        	        var flag	 = "01";
		        	        //var zipcode	 = "123-456";
							
							var addressList	= "<li><a href=\"javascript:selectBunji('"+bunji+"','"+building+"','"+point_x+"','"+point_y+"','"+add_type+"','"+flag+"','');\">";
							
							if(bunji != "")
								addressList	+= "("+bunji+")" + building+"</a></li>";
							else
								addressList	+= building+"</a></li>";
						
							$(".addressList").append(addressList);
						}
					}
				},
				error:function(){
					alert("주소검색 요청 실패");
				}
			});
			
			// 버튼 이중클릭 해제
			$(this).attr("disabled", false);
			
		}
	});
	//----------------------------------------------------
	// 도로명 주소검색 - 도로명 검색
	//----------------------------------------------------
	$(".searchRoadBtn").click(function(e){
			
		if($(tabCon+" .searchRoad").val() == "")
			alert("도로명을 입력해주세요.");
		else{
			//지번주소 검색리스트 초기화
			clearFirstSearchResult();
			clearSecondSearchResult();
				
			//로딩 표시
			var addressList = "<li><a href=\"#\">주소정보를 읽어오고 있습니다.</a></li>";
			$(tabCon+" .addressList").append(addressList);
				
			var params = 
					{url:kainess_road_search_url,
					 url_code:"04",
					 name:$(tabCon+" .searchRoad").val()
					 }; 
				
			// 버튼 이중클릭 방지
			$(this).attr("disabled", true);
			
			$.ajax({
				type: "POST",
				url : "/common/getAddress.json",
				data: params,
				dataType: "json",
		        contentType:'application/x-www-form-urlencoded; charset=UTF-8',
				success:function(data){
									
					//지번주소 검색리스트 초기화
					$(tabCon+" .addressList").empty();
						
					if(data.length == 0)
						$(tabCon+" .addressList").append("<li>주소가 존재하지 않습니다.</li>");
					else{
						for(var i=0; i<data.length; i++ ) {
				                 	
		        			var code   	 = data[i].roadcode;
						    var sido   	 = data[i].sido;
						    var gugun  	 = data[i].gugun;
						    var dong   	 = data[i].dong;
						    var ri    	 = data[i].roadname;
						    var fullname = data[i].roadaddr;
									
							var addressList = "<li><a href=\"javascript:selectRoad('"+code+"','"+sido+"','"+gugun+"','"+dong+"','"+ri+"','"+fullname+"');\">";
							addressList	+= fullname+"</a></li>";
								
							$(tabCon+" .addressList").append(addressList);
						}
					}
				},
				error:function(){
					alert("주소검색 요청 실패");
				}
			});	
				
			// 버튼 이중클릭 해제
			$(this).attr("disabled", false);
		}
	});	
		
	//----------------------------------------------------
	//  도로명 주소검색 - 지번  주소검색
	//----------------------------------------------------
	$(".searchJibunBtn").click(function(e){
		
		if($(tabCon+" .searchJibun").val() == "")
			alert("지번 또는 건물명을 입력해주세요.");
		else if($(tabCon+" .searchRoad").val() == "" || $("#search_result_code").val()==""){
			alert("도로명을 먼저 검색해주세요.");
			$(tabCon+" .searchRoad").val("");
			$(tabCon+" .searchRoad").focus();
		}
		else{
			//지번주소 검색리스트 초기화
			clearSecondSearchResult();
				
			//로딩 표시
			var addressList = "<li><a href=\"#\">주소정보를 읽어오고 있습니다.</a></li>";
			$(tabCon+" .addressList").append(addressList);
				
			//지번 검색 파라미터
			var params = 
					{url : kainess_jibun_search_url,
					 url_code : "05",
					 roadnum : $(tabCon+" .searchJibun").val(),
					 code : $('#search_result_code').val()
					 }; 
				
			// 버튼 이중클릭 방지
			$(this).attr("disabled", true);
			
			$.ajax({
				type: "POST",
				url : "/common/getAddress.json",
				data: params,
				dataType: "json",
		        contentType:'application/x-www-form-urlencoded; charset=UTF-8',
				success:function(data){
					
					if($(".full_address").val() == "서울특별시 관악구 관악로") { //관악로 예외처리
						$.each(data, function(i,zipcode){
							if(zipcode.mn == "1") {
								data.splice(i,1);
								return false;
							}
						}); 
					}
					
					if($(".full_address").val() == '경기도 의정부시 범골로63번길') {
						$.each(data, function(i,zipcode){
							if(zipcode.mn == "31") {
								data.splice(i,1);
								return false;
							}
						}); 
					}

					//지번주소 검색리스트 초기화
					$(tabCon+" .addressList").empty();
						
					if(data.length == 0)
						$(tabCon+" .addressList").append("<li>주소가 존재하지 않습니다.</li>");
					else{
						for(var i=0; i<data.length; i++ ) {
				                 	
							var strText = "";
			            	if(data[i].under != "0") {
				            	if(data[i].under == "1") {
				            		strText = "지하";
				            	} else if(data[i].under == "2") {
				            		strText = "공중";
				            	} else {
				            		strText = data[i].under;
				            	}
			            	}
			            	
			            	strText = strText + data[i].mn;;
			            		
			            	if(data[i].sn != "" && data[i].sn != "0") {
		            			strText = strText + "-" + data[i].sn;
		            		}
		            			
		            		var jibun  		= strText;
		            		var building 	= "";
		            		var point_x     = data[i].point_x;
		            	    var point_y     = data[i].point_y;
		            	    var add_type    = "J";
		            	    var flag		= "02";
		            	    //var zipcode		= "123-456";
							
							var addressList	= "<li><a href=\"javascript:selectJibun('"+jibun+"','"+building+"','"+point_x+"','"+point_y+"','"+add_type+"','"+flag+"','');\">";
							addressList	+= jibun +"</a></li>";
						
							$(tabCon+" .addressList").append(addressList);
						}
					}
				},
				error:function(){
					alert("주소검색 요청 실패");
				}
			});	
			
			
			// 버튼 이중클릭 해제
			$(this).attr("disabled", false);
		}
	});	

	//----------------------------------------------------
	// 주소검색팝업 - 상세입력버튼 Action
	//----------------------------------------------------
	$("#zipcode .detailBtn").click(function(){
		
		$("#zipcode .addressDetail").val($("#zipcode .detailAddress").val());
	});
	
	
	//----------------------------------------------------
	// 주소검색팝업 - 확인버튼 Action
	//----------------------------------------------------
	$("#zipcode .addressSubmit").click(function(){

		if(window.location.pathname == "/mypage/myInfo_step2" || window.location.pathname == "/login_join/join"){
			//console.log($(".ziplist").attr("style"));
			//console.log($("#zipcheckList option:selected").val());
			if($(".ziplist").attr("style") != "display:none;" && $("#zipcheckList option:selected").val() == ""){
				alert("상세주소를 선택해 주세요.");
				return;

			}
			
			if($(".addressDetail").val() == ""){
				if(!confirm("상세주소를 입력하지 않았습니다.\n상세주소 없이 배달지를 등록하시겠습니까?\n\n내 배달주소 : " + $(".full_address").val())){
					$(".addressDetail").focus();
					return;
				}
			}
			
			$("#cust_haddr").val($("#search_result_addr").val());
			
			var daddr = $(".addressDetail").val();
			if($("#search_result_convertRoad").val() != ""){
				daddr = daddr + "/" + $("#search_result_convertRoad").val();
			}
			
			if(daddr.length > 30){
				daddr = daddr.substring(0, 30);
			}

			$("#cust_daddr").val(daddr);
			
			$("#add_new_gubun").val($("#search_result_gubun").val());
			
			$("#cust_haddr").focus();
			
			// 팝업창 닫음
			$(popCon+" .pop_close").trigger("click");
			
			
		}else{
			if($(".full_address").val() == "" || $(".full_address").val() == null){
				alert("주소검색/선택 후 다시 진행 해주세요.");
				return;
				
			}
			else if($("#search_result_point_x").val() == "" || $("#search_result_point_x").val() == null){
				alert("매장 좌표 검색이 되지 않았습니다. 다시 조회해주세요.");
				return;
			}
			else if($("#search_result_point_y").val() == "" || $("#search_result_point_y").val() == null){
				alert("매장 좌표 검색이 되지 않았습니다. 다시 조회해주세요.");
				return;
			}
			else if($("#search_result_branch_idx").val() == "" || $("#search_result_branch_idx").val() == null){
				alert("매장이 검색되지 않았습니다. 다시 검색해주세요.");
				return;
			}
			else{
					
				if($(".addressDetail").val() == ""){
					if(!confirm("상세주소를 입력하지 않았습니다.\n상세주소 없이 배달지를 등록하시겠습니까?\n\n내 배달주소 : " + $(".full_address").val())){
						$(".addressDetail").focus();
						return;
					}
				}
				
				$("#cust_haddr").val($("#search_result_addr").val());
				
				var daddr = $(".addressDetail").val();
				if($("#search_result_convertRoad").val() != ""){
					daddr = daddr + "/" + $("#search_result_convertRoad").val();
				}
				
				if(daddr.length > 30){
					daddr = daddr.substring(0, 30);
				}

				$("#cust_daddr").val(daddr);
				
				$("#add_new_gubun").val($("#search_result_gubun").val());
				
				$("#cust_haddr").focus();
				
				// 팝업창 닫음
				$(popCon+" .pop_close").trigger("click");
			//}
			}
			
		}

	});
		
	//----------------------------------------------------
	// 매장검색 팝업 - 확인버튼 Action
	//----------------------------------------------------	
	$("#popStore .addressSubmit").click(function(){
		
		if($("#search_result_branch_id").val() == "" || $(tabCon+" input:eq(0)").val() == "")
		{
			alert("매장을 검색하지 않으셨습니다. 매장검색을 다시 하십시오.");
			$(tabCon+" .addressList").empty();	// 리스트 초기화
			$(tabCon+" input:eq(0)").focus();
			return;
		}
		/*else if($(tabCon+" .addressDetail").val() == "")  매장 팝업에서 상세주소 일단 제외
		{
			alert("상세주소를 입력해주세요.");
			$(tabCon+" .addressDetail").focus();
			return;
		}*/
		else
		{
			// 매장 검색 결과 전송
			$("#inpStore").val($("#search_result_branch_nm").val());
					
			$("#inpStore").focus();
			
			// 팝업창 닫음
			$(popCon+" .pop_close").trigger("click");
			
			
		}		 
	});
	
	//----------------------------------------------------
	// 주소검색팝업 - 재입력 버튼 Action
	//----------------------------------------------------
	$('#zipcode .searchAddrReset').click(function(){
		
		// 리스트 초기화
		$(tabCon+" .addressList").empty();
		
		// 주소 검색 관련 데이터 초기화
		$("#zipcode input").val("");
		
		// 첫번째 입력창 포커스
		$(tabCon+" input:eq(0)").focus();
		
		$("#storename").empty();
		$(".ziplist").hide();
		$("#zipcheckList").empty();
		
		daumPostcode('orderDaumZipcode','orderAddress1');
	});
	
	//----------------------------------------------------
	// 매장검색팝업 - 재입력 버튼 Action
	//----------------------------------------------------
	$('#popStore .searchAddrReset').click(function(){
		
		// 리스트 초기화
		$(tabCon+" .addressList").empty();
		
		// 주소 검색 관련 데이터 초기화
		clearOldData();
		clearRoadData();
		clearStoreData();
		
		// 상세주소 입력창 초기화
		$(".addressDetail").val("");
		
		// 첫번째 입력창 포커스
		$(tabCon+" input:eq(0)").focus();
	});
	
});